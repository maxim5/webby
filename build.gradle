import org.apache.tools.ant.taskdefs.condition.Os

plugins {
    id 'java'
    id 'java-library'
    id 'idea'
    id 'nu.studer.rocker' version '3.0.2'
}

group 'io.webby'
version '0.7.0-SNAPSHOT'

repositories {
    mavenCentral()
    maven { url 'https://jitpack.io' }
    maven { url 'https://raw.githubusercontent.com/bulldog2011/bulldog-repo/master/repo/releases/' }
}

def os
if (Os.isFamily(Os.FAMILY_UNIX)) {
    os = 'linux64'
} else if (Os.isFamily(Os.FAMILY_MAC)) {
    os = 'osx64'
} else if (Os.isFamily(Os.FAMILY_WINDOWS)) {
    os = 'win64'
}

// Prod
dependencies {
    // API
    api group: 'com.google.guava', name: 'guava', version: '31.0.1-jre'
    api group: 'com.google.inject', name: 'guice', version: '5.0.1'
    api group: 'com.google.mug', name: 'mug', version: '5.7'
    api group: 'io.netty', name: 'netty-all', version: '4.1.72.Final'
    // RouteKit
    api group: 'io.routekit', name: 'routekit', version: 'v0.2.0'

    // Implementation
    implementation group: 'com.carrotsearch', name: 'hppc', version: '0.9.1'
    implementation group: 'org.jetbrains', name: 'annotations', version: '22.0.0'

    // Google Flogger
    compileOnly group: 'com.google.flogger', name: 'flogger', version: '0.7.4'
    runtimeOnly group: 'com.google.flogger', name: 'flogger-log4j2-backend', version: '0.7.4'

    compileOnly group: 'com.google.protobuf', name: 'protobuf-java', version: '3.19.1'
    compileOnly group: 'com.leansoft', name: 'bigqueue', version: '0.7.3'

    // Json
    compileOnly group: 'com.alibaba', name: 'fastjson', version: '1.2.79'
    compileOnly group: 'com.dslplatform', name: 'dsl-json-java8', version: '1.9.9'
    compileOnly group: 'com.fasterxml.jackson.core', name: 'jackson-databind', version: '2.13.1'
    compileOnly group: 'com.google.code.gson', name: 'gson', version: '2.8.9'
    compileOnly group: 'com.squareup.moshi', name: 'moshi', version: '1.13.0'
    compileOnly group: 'org.jodd', name: 'jodd-json', version: '6.0.3'

    // Templates
    compileOnly group: 'com.fizzed', name: 'rocker-runtime', version: '1.3.0'
    compileOnly group: 'com.github.jknack', name: 'handlebars', version: '4.3.0'
    compileOnly group: 'com.github.spullara.mustache.java', name: 'compiler', version: '0.9.10'
    compileOnly group: 'com.samskivert', name: 'jmustache', version: '1.15'
    compileOnly group: 'gg.jte', name: 'jte', version: '1.12.1'
    compileOnly group: 'io.pebbletemplates', name: 'pebble', version: '3.1.5'
    compileOnly group: 'org.apache.velocity', name: 'velocity', version: '1.7'
    compileOnly group: 'org.freemarker', name: 'freemarker', version: '2.3.31'
    compileOnly group: 'org.thymeleaf', name: 'thymeleaf', version: '3.0.14.RELEASE'
    compileOnly group: 'org.trimou', name: 'trimou-core', version: '2.5.1.Final'

    // Embedded Key-Values
    compileOnly group: 'com.github.cojen', name: 'Tupl', version: '1.5.3.1'
    compileOnly group: 'com.github.yahoo', name: 'HaloDB', version: 'v0.5.6'
    compileOnly group: 'com.linkedin.paldb', name: 'paldb', version: '1.2.0'
    compileOnly group: 'com.yahoo.oak', name: 'oak', version: '0.2.3.1'
    compileOnly group: 'io.swaydb', name: 'java_2.13', version: '0.16.2'
    compileOnly group: 'net.openhft', name: 'chronicle-map', version: '3.21.86'
    compileOnly group: 'org.deephacks.lmdbjni', name: 'lmdbjni', version: '0.4.6'
    runtimeOnly group: 'org.deephacks.lmdbjni', name: "lmdbjni-$os", version: '0.4.6'
    compileOnly group: 'org.fusesource.leveldbjni', name: 'leveldbjni', version: '1.8'
    runtimeOnly group: 'org.fusesource.leveldbjni', name: "leveldbjni-$os", version: '1.8'
    compileOnly group: 'org.iq80.leveldb', name: 'leveldb', version: '0.12'
    compileOnly group: 'org.lmdbjava', name: 'lmdbjava', version: '0.8.2'
    compileOnly group: 'org.mapdb', name: 'mapdb', version: '3.0.8'
    compileOnly group: 'org.rocksdb', name: 'rocksdbjni', version: '6.26.1'

    // External NoSQLs
    compileOnly group: 'io.etcd', name: 'jetcd-core', version: '0.6.1'
    compileOnly group: 'redis.clients', name: 'jedis', version: '3.7.1'

    // SQLs
    compileOnly group: 'com.h2database', name: 'h2', version: '1.4.200'
    compileOnly group: 'com.zaxxer', name: 'HikariCP', version: '5.0.0'
    compileOnly group: 'mysql', name: 'mysql-connector-java', version: '8.0.27'
    compileOnly group: 'org.xerial', name: 'sqlite-jdbc', version: '3.36.0.3'

    // MimeType utils
    compileOnly group: 'com.j256.simplemagic', name: 'simplemagic', version: '1.16'
    compileOnly group: 'eu.medsea.mimeutil', name: 'mime-util', version: '2.1.3'
}

// Testing
dependencies {
    // JUnit, Truth, Mockito
    testImplementation group: 'org.junit.jupiter', name: 'junit-jupiter-api', version: '5.8.2'
    testCompileOnly group: 'org.junit.jupiter', name: 'junit-jupiter-params', version: '5.8.2'
    testRuntimeOnly group: 'org.junit.jupiter', name: 'junit-jupiter-engine', version: '5.8.2'
    testImplementation group: 'com.google.truth', name: 'truth', version: '1.1.3'
    testImplementation group: 'org.mockito', name: 'mockito-inline', version: '4.2.0'
    // Utilities for Unit tests
    testImplementation group: 'com.google.code.gson', name: 'gson', version: '2.8.9'
    testImplementation group: 'com.google.flogger', name: 'flogger-log4j2-backend', version: '0.7.4'
    testImplementation group: 'com.j256.simplemagic', name: 'simplemagic', version: '1.16'
    testImplementation group: 'com.squareup.okhttp3', name: 'okhttp', version: '4.10.0-RC1'
    testImplementation group: 'com.squareup.okio', name: 'okio', version: '3.0.0'
    // SQLs for Unit tests
    testImplementation group: 'com.h2database', name: 'h2', version: '1.4.200'
    testImplementation group: 'com.zaxxer', name: 'HikariCP', version: '5.0.0'
    testImplementation group: 'mysql', name: 'mysql-connector-java', version: '8.0.27'
    testImplementation group: 'org.testcontainers', name: 'mysql', version: '1.16.2'
    testImplementation group: 'org.testcontainers', name: 'testcontainers', version: '1.16.2'
    testImplementation group: 'org.xerial', name: 'sqlite-jdbc', version: '3.36.0.3'
    // NoSQLs for Integration tests
    testImplementation group: 'io.etcd', name: 'jetcd-test', version: '0.6.1'
    testImplementation group: 'it.ozimov', name: 'embedded-redis', version: '0.7.3'
}

test {
    useJUnitPlatform()
}

apply from: 'src/examplesModel/examplesModel.gradle'
apply from: 'src/examples/examples.gradle'
apply from: 'src/integration/integration.gradle'
